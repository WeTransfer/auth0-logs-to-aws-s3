module.exports=function(e){function t(o){if(n[o])return n[o].exports;var r=n[o]={exports:{},id:o,loaded:!1};return e[o].call(r.exports,r,r.exports,t),r.loaded=!0,r.exports}var n={};return t.m=e,t.c=n,t.p="/build/",t(0)}([function(e,t,n){(function(t){"use strict";function o(e,n){var o=e.webtaskContext,c=["AUTH0_DOMAIN","AUTH0_GLOBAL_CLIENT_ID","AUTH0_GLOBAL_CLIENT_SECRET","STORAGE_ACCOUNT_NAME","STORAGE_ACCOUNT_KEY","STORAGE_CONTAINER_NAME"],u=c.filter(function(e){return!o.data[e]});return u.length?n.status(400).send({message:"Missing settings: "+u.join(", ")}):void e.webtaskContext.storage.get(function(c,u){var f="undefined"==typeof u?null:u.checkpointId,d=new r({domain:o.data.AUTH0_DOMAIN,clientID:o.data.AUTH0_GLOBAL_CLIENT_ID,clientSecret:o.data.AUTH0_GLOBAL_CLIENT_SECRET}),p=s.createBlobService(o.data.STORAGE_ACCOUNT_NAME,o.data.STORAGE_ACCOUNT_KEY);i.waterfall([function(e){d.getAccessToken(function(t){return t&&console.log("Error authenticating:",t),e(t)})},function(e){try{p.createContainerIfNotExists(o.data.STORAGE_CONTAINER_NAME,function(t){return e(t)})}catch(t){return e(t)}},function(e){var n=function o(n){console.log("Downloading logs from: "+(n.checkpointId||"Start")+"."),n.logs=n.logs||[],d.getLogs({take:200,from:n.checkpointId},function(r,i){return r?e(r):i&&i.length?(i.forEach(function(e){return n.logs.push(e)}),n.checkpointId=n.logs[n.logs.length-1]._id,t(function(){return o(n)})):(console.log("Total logs: "+n.logs.length+"."),e(null,n))})};n({checkpointId:f})},function(e,t){e.logs=e.logs.map(function(e){var t=0;e.type_code=e.type,v[e.type]&&(t=v[e.type].level,e.type=v[e.type].event);var n=a.parse(e.user_agent);return e.os=n.os.toString(),e.os_version=n.os.toVersion(),e.device=n.device.toString(),e.device_version=n.device.toVersion(),e}),t(null,e)},function(e,t){console.log("Uploading blobs..."),i.eachLimit(e.logs,5,function(e,t){var n=l(e.date),r=n.format("YYYY/MM/DD")+"/"+n.format("HH")+"/"+e._id+".json";console.log("Uploading "+r+"."),p.createBlockBlobFromText(o.data.STORAGE_CONTAINER_NAME,r,JSON.stringify(e),t)},function(n){return n?t(n):(console.log("Upload complete."),t(null,e))})}],function(t,o){return t?(console.log("Job failed."),e.webtaskContext.storage.set({checkpointId:f},{force:1},function(e){return e?n.status(500).send(e):void n.status(500).send({error:t})})):(console.log("Job complete."),e.webtaskContext.storage.set({checkpointId:o.checkpointId,totalLogsProcessed:o.logs.length},{force:1},function(e){return e?n.status(500).send(e):void n.sendStatus(200)}))})})}var r=n(3),i=n(4),l=n(5),s=n(6),a=n(7),c=n(8),u=n(9),f=c(),v={s:{event:"Success Login",level:1},seacft:{event:"Success Exchange",level:1},feacft:{event:"Failed Exchange",level:3},f:{event:"Failed Login",level:3},w:{event:"Warnings During Login",level:2},du:{event:"Deleted User",level:1},fu:{event:"Failed Login (invalid email/username)",level:3},fp:{event:"Failed Login (wrong password)",level:3},fc:{event:"Failed by Connector",level:3},fco:{event:"Failed by CORS",level:3},con:{event:"Connector Online",level:1},coff:{event:"Connector Offline",level:3},fcpro:{event:"Failed Connector Provisioning",level:4},ss:{event:"Success Signup",level:1},fs:{event:"Failed Signup",level:3},cs:{event:"Code Sent",level:0},cls:{event:"Code/Link Sent",level:0},sv:{event:"Success Verification Email",level:0},fv:{event:"Failed Verification Email",level:0},scp:{event:"Success Change Password",level:1},fcp:{event:"Failed Change Password",level:3},sce:{event:"Success Change Email",level:1},fce:{event:"Failed Change Email",level:3},scu:{event:"Success Change Username",level:1},fcu:{event:"Failed Change Username",level:3},scpn:{event:"Success Change Phone Number",level:1},fcpn:{event:"Failed Change Phone Number",level:3},svr:{event:"Success Verification Email Request",level:0},fvr:{event:"Failed Verification Email Request",level:3},scpr:{event:"Success Change Password Request",level:0},fcpr:{event:"Failed Change Password Request",level:3},fn:{event:"Failed Sending Notification",level:3},sapi:{event:"API Operation"},fapi:{event:"Failed API Operation"},limit_wc:{event:"Blocked Account",level:4},limit_ui:{event:"Too Many Calls to /userinfo",level:4},api_limit:{event:"Rate Limit On API",level:4},sdu:{event:"Successful User Deletion",level:1},fdu:{event:"Failed User Deletion",level:3}};f.get("/",o),f.post("/",o),e.exports=u.fromExpress(f)}).call(t,n(1).setImmediate)},function(e,t,n){(function(e,o){function r(e,t){this._id=e,this._clearFn=t}var i=n(2).nextTick,l=Function.prototype.apply,s=Array.prototype.slice,a={},c=0;t.setTimeout=function(){return new r(l.call(setTimeout,window,arguments),clearTimeout)},t.setInterval=function(){return new r(l.call(setInterval,window,arguments),clearInterval)},t.clearTimeout=t.clearInterval=function(e){e.close()},r.prototype.unref=r.prototype.ref=function(){},r.prototype.close=function(){this._clearFn.call(window,this._id)},t.enroll=function(e,t){clearTimeout(e._idleTimeoutId),e._idleTimeout=t},t.unenroll=function(e){clearTimeout(e._idleTimeoutId),e._idleTimeout=-1},t._unrefActive=t.active=function(e){clearTimeout(e._idleTimeoutId);var t=e._idleTimeout;t>=0&&(e._idleTimeoutId=setTimeout(function(){e._onTimeout&&e._onTimeout()},t))},t.setImmediate="function"==typeof e?e:function(e){var n=c++,o=arguments.length<2?!1:s.call(arguments,1);return a[n]=!0,i(function(){a[n]&&(o?e.apply(null,o):e.call(null),t.clearImmediate(n))}),n},t.clearImmediate="function"==typeof o?o:function(e){delete a[e]}}).call(t,n(1).setImmediate,n(1).clearImmediate)},function(e,t){function n(){c=!1,l.length?a=l.concat(a):u=-1,a.length&&o()}function o(){if(!c){var e=setTimeout(n);c=!0;for(var t=a.length;t;){for(l=a,a=[];++u<t;)l&&l[u].run();u=-1,t=a.length}l=null,c=!1,clearTimeout(e)}}function r(e,t){this.fun=e,this.array=t}function i(){}var l,s=e.exports={},a=[],c=!1,u=-1;s.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];a.push(new r(e,t)),1!==a.length||c||setTimeout(o,0)},r.prototype.run=function(){this.fun.apply(null,this.array)},s.title="browser",s.browser=!0,s.env={},s.argv=[],s.version="",s.versions={},s.on=i,s.addListener=i,s.once=i,s.off=i,s.removeListener=i,s.removeAllListeners=i,s.emit=i,s.binding=function(e){throw new Error("process.binding is not supported")},s.cwd=function(){return"/"},s.chdir=function(e){throw new Error("process.chdir is not supported")},s.umask=function(){return 0}},function(e,t){e.exports=require("auth0@0.8.2")},function(e,t){e.exports=require("async")},function(e,t){e.exports=require("moment")},function(e,t){e.exports=require("azure-storage")},function(e,t){e.exports=require("useragent")},function(e,t){e.exports=require("express")},function(e,t,n){function o(e){return function(t,n,o){var r=l(n.x_wt.jtn);return n.originalUrl=n.url,n.url=n.url.replace(r,"/"),n.webtaskContext=s(t),e(n,o)}}function r(e){var t;return e.ext("onRequest",function(e,n){var o=l(e.x_wt.jtn);e.setUrl(e.url.replace(o,"/")),e.webtaskContext=t}),function(n,o,r){var i=e._dispatch();t=s(n),i(o,r)}}function i(e){return function(t,n,o){var r=l(n.x_wt.jtn);return n.originalUrl=n.url,n.url=n.url.replace(r,"/"),n.webtaskContext=s(t),e.emit("request",n,o)}}function l(e){var t="^/api/run/[^/]+/",n="(?:[^/?#]*/?)?";return new RegExp(t+(e?n:""))}function s(e){function t(e,t,o){var r=n(10);"function"==typeof t&&(o=t,t={}),o(r.preconditionFailed("Storage is not available in this context"))}function o(t,o,r){var i=n(10),l=n(11);"function"==typeof o&&(r=o,o={}),l({uri:e.secrets.EXT_STORAGE_URL,method:"GET",headers:o.headers||{},qs:{path:t},json:!0},function(e,t,n){return e?r(i.wrap(e,502)):404===t.statusCode&&Object.hasOwnProperty.call(o,"defaultValue")?r(null,o.defaultValue):t.statusCode>=400?r(i.create(t.statusCode,n&&n.message)):void r(null,n)})}function r(e,t,o,r){var i=n(10);"function"==typeof o&&(r=o,o={}),r(i.preconditionFailed("Storage is not available in this context"))}function i(t,o,r,i){var l=n(10),s=n(11);"function"==typeof r&&(i=r,r={}),s({uri:e.secrets.EXT_STORAGE_URL,method:"PUT",headers:r.headers||{},qs:{path:t},body:o},function(e,t,n){return e?i(l.wrap(e,502)):t.statusCode>=400?i(l.create(t.statusCode,n&&n.message)):void i(null)})}return e.read=e.secrets.EXT_STORAGE_URL?o:t,e.write=e.secrets.EXT_STORAGE_URL?i:r,e}t.fromConnect=t.fromExpress=o,t.fromHapi=r,t.fromServer=t.fromRestify=i},function(e,t){e.exports=require("boom")},function(e,t){e.exports=require("request")}]);